{
  "version": 3,
  "sources": ["../../src/lib/defaultExternalContentHandlers.ts"],
  "sourcesContent": ["import {\n\tAssetRecordType,\n\tEditor,\n\tFileHelpers,\n\tMediaHelpers,\n\tTLAsset,\n\tTLAssetId,\n\tTLBookmarkShape,\n\tTLEmbedShape,\n\tTLShapeId,\n\tTLShapePartial,\n\tTLTextShape,\n\tTLTextShapeProps,\n\tVec,\n\tVecLike,\n\tWeakCache,\n\tassert,\n\tcompact,\n\tcreateShapeId,\n\tfetch,\n\tgetHashForBuffer,\n\tgetHashForString,\n} from '@tldraw/editor'\nimport { getAssetFromIndexedDb, storeAssetInIndexedDb } from './AssetBlobStore'\nimport { FONT_FAMILIES, FONT_SIZES, TEXT_PROPS } from './shapes/shared/default-shape-constants'\nimport { TLUiToastsContextType } from './ui/context/toasts'\nimport { useTranslation } from './ui/hooks/useTranslation/useTranslation'\nimport { containBoxSize } from './utils/assets/assets'\nimport { getEmbedInfo } from './utils/embeds/embeds'\nimport { cleanupText, isRightToLeftLanguage } from './utils/text/text'\n\n/** @public */\nexport interface TLExternalContentProps {\n\t/**\n\t * The maximum dimension (width or height) of an image. Images larger than this will be rescaled\n\t * to fit. Defaults to infinity.\n\t */\n\tmaxImageDimension?: number\n\t/**\n\t * The maximum size (in bytes) of an asset. Assets larger than this will be rejected. Defaults\n\t * to 10mb (10 * 1024 * 1024).\n\t */\n\tmaxAssetSize?: number\n\t/**\n\t * The mime types of images that are allowed to be handled. Defaults to\n\t * DEFAULT_SUPPORTED_IMAGE_TYPES.\n\t */\n\tacceptedImageMimeTypes?: readonly string[]\n\t/**\n\t * The mime types of videos that are allowed to be handled. Defaults to\n\t * DEFAULT_SUPPORT_VIDEO_TYPES.\n\t */\n\tacceptedVideoMimeTypes?: readonly string[]\n}\n\nexport function registerDefaultExternalContentHandlers(\n\teditor: Editor,\n\t{\n\t\tmaxImageDimension,\n\t\tmaxAssetSize,\n\t\tacceptedImageMimeTypes,\n\t\tacceptedVideoMimeTypes,\n\t}: Required<TLExternalContentProps>,\n\t{ toasts, msg }: { toasts: TLUiToastsContextType; msg: ReturnType<typeof useTranslation> },\n\tpersistenceKey?: string\n) {\n\t// files -> asset\n\teditor.registerExternalAssetHandler('file', async ({ file: _file }) => {\n\t\tconst name = _file.name\n\t\tlet file: Blob = _file\n\t\tconst isImageType = acceptedImageMimeTypes.includes(file.type)\n\t\tconst isVideoType = acceptedVideoMimeTypes.includes(file.type)\n\n\t\tassert(isImageType || isVideoType, `File type not allowed: ${file.type}`)\n\t\tassert(\n\t\t\tfile.size <= maxAssetSize,\n\t\t\t`File size too big: ${(file.size / 1024).toFixed()}kb > ${(maxAssetSize / 1024).toFixed()}kb`\n\t\t)\n\n\t\tif (file.type === 'video/quicktime') {\n\t\t\t// hack to make .mov videos work\n\t\t\tfile = new Blob([file], { type: 'video/mp4' })\n\t\t}\n\n\t\tlet size = isImageType\n\t\t\t? await MediaHelpers.getImageSize(file)\n\t\t\t: await MediaHelpers.getVideoSize(file)\n\n\t\tconst isAnimated = (await MediaHelpers.isAnimated(file)) || isVideoType\n\n\t\tconst hash = await getHashForBuffer(await file.arrayBuffer())\n\n\t\tif (isFinite(maxImageDimension)) {\n\t\t\tconst resizedSize = containBoxSize(size, { w: maxImageDimension, h: maxImageDimension })\n\t\t\tif (size !== resizedSize && MediaHelpers.isStaticImageType(file.type)) {\n\t\t\t\tsize = resizedSize\n\t\t\t}\n\t\t}\n\n\t\tconst assetId: TLAssetId = AssetRecordType.createId(hash)\n\t\tconst assetInfo = {\n\t\t\tid: assetId,\n\t\t\ttype: isImageType ? 'image' : 'video',\n\t\t\ttypeName: 'asset',\n\t\t\tprops: {\n\t\t\t\tname,\n\t\t\t\tsrc: '',\n\t\t\t\tw: size.w,\n\t\t\t\th: size.h,\n\t\t\t\tfileSize: file.size,\n\t\t\t\tmimeType: file.type,\n\t\t\t\tisAnimated,\n\t\t\t},\n\t\t} as TLAsset\n\n\t\tif (persistenceKey) {\n\t\t\tassetInfo.props.src = assetId\n\t\t\tawait storeAssetInIndexedDb({\n\t\t\t\tpersistenceKey,\n\t\t\t\tassetId,\n\t\t\t\tblob: file,\n\t\t\t})\n\t\t} else {\n\t\t\tassetInfo.props.src = await FileHelpers.blobToDataUrl(file)\n\t\t}\n\n\t\treturn AssetRecordType.create(assetInfo)\n\t})\n\n\t// urls -> bookmark asset\n\teditor.registerExternalAssetHandler('url', async ({ url }) => {\n\t\tlet meta: { image: string; favicon: string; title: string; description: string }\n\n\t\ttry {\n\t\t\tconst resp = await fetch(url, {\n\t\t\t\tmethod: 'GET',\n\t\t\t\tmode: 'no-cors',\n\t\t\t})\n\t\t\tconst html = await resp.text()\n\t\t\tconst doc = new DOMParser().parseFromString(html, 'text/html')\n\t\t\tmeta = {\n\t\t\t\timage: doc.head.querySelector('meta[property=\"og:image\"]')?.getAttribute('content') ?? '',\n\t\t\t\tfavicon:\n\t\t\t\t\tdoc.head.querySelector('link[rel=\"apple-touch-icon\"]')?.getAttribute('href') ??\n\t\t\t\t\tdoc.head.querySelector('link[rel=\"icon\"]')?.getAttribute('href') ??\n\t\t\t\t\t'',\n\t\t\t\ttitle: doc.head.querySelector('meta[property=\"og:title\"]')?.getAttribute('content') ?? url,\n\t\t\t\tdescription:\n\t\t\t\t\tdoc.head.querySelector('meta[property=\"og:description\"]')?.getAttribute('content') ?? '',\n\t\t\t}\n\t\t\tif (meta.image.startsWith('/')) {\n\t\t\t\tmeta.image = new URL(meta.image, url).href\n\t\t\t}\n\t\t\tif (meta.favicon.startsWith('/')) {\n\t\t\t\tmeta.favicon = new URL(meta.favicon, url).href\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(error)\n\t\t\ttoasts.addToast({\n\t\t\t\ttitle: msg('assets.url.failed'),\n\t\t\t\tseverity: 'error',\n\t\t\t})\n\t\t\tmeta = { image: '', favicon: '', title: '', description: '' }\n\t\t}\n\n\t\t// Create the bookmark asset from the meta\n\t\treturn {\n\t\t\tid: AssetRecordType.createId(getHashForString(url)),\n\t\t\ttypeName: 'asset',\n\t\t\ttype: 'bookmark',\n\t\t\tprops: {\n\t\t\t\tsrc: url,\n\t\t\t\tdescription: meta.description,\n\t\t\t\timage: meta.image,\n\t\t\t\tfavicon: meta.favicon,\n\t\t\t\ttitle: meta.title,\n\t\t\t},\n\t\t\tmeta: {},\n\t\t}\n\t})\n\n\t// svg text\n\teditor.registerExternalContentHandler('svg-text', async ({ point, text }) => {\n\t\tconst position =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey\n\t\t\t\t? editor.inputs.currentPagePoint\n\t\t\t\t: editor.getViewportPageBounds().center)\n\n\t\tconst svg = new DOMParser().parseFromString(text, 'image/svg+xml').querySelector('svg')\n\t\tif (!svg) {\n\t\t\tthrow new Error('No <svg/> element present')\n\t\t}\n\n\t\tlet width = parseFloat(svg.getAttribute('width') || '0')\n\t\tlet height = parseFloat(svg.getAttribute('height') || '0')\n\n\t\tif (!(width && height)) {\n\t\t\tdocument.body.appendChild(svg)\n\t\t\tconst box = svg.getBoundingClientRect()\n\t\t\tdocument.body.removeChild(svg)\n\n\t\t\twidth = box.width\n\t\t\theight = box.height\n\t\t}\n\n\t\tconst asset = await editor.getAssetForExternalContent({\n\t\t\ttype: 'file',\n\t\t\tfile: new File([text], 'asset.svg', { type: 'image/svg+xml' }),\n\t\t})\n\n\t\tif (!asset) throw Error('Could not create an asset')\n\n\t\tcreateShapesForAssets(editor, [asset], position)\n\t})\n\n\t// embeds\n\teditor.registerExternalContentHandler('embed', ({ point, url, embed }) => {\n\t\tconst position =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey\n\t\t\t\t? editor.inputs.currentPagePoint\n\t\t\t\t: editor.getViewportPageBounds().center)\n\n\t\tconst { width, height } = embed\n\n\t\tconst id = createShapeId()\n\n\t\tconst shapePartial: TLShapePartial<TLEmbedShape> = {\n\t\t\tid,\n\t\t\ttype: 'embed',\n\t\t\tx: position.x - (width || 450) / 2,\n\t\t\ty: position.y - (height || 450) / 2,\n\t\t\tprops: {\n\t\t\t\tw: width,\n\t\t\t\th: height,\n\t\t\t\turl,\n\t\t\t},\n\t\t}\n\n\t\teditor.createShapes([shapePartial]).select(id)\n\t})\n\n\t// files\n\teditor.registerExternalContentHandler('files', async ({ point, files }) => {\n\t\tconst position =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey\n\t\t\t\t? editor.inputs.currentPagePoint\n\t\t\t\t: editor.getViewportPageBounds().center)\n\n\t\tconst pagePoint = new Vec(position.x, position.y)\n\n\t\tconst assets: TLAsset[] = []\n\n\t\tawait Promise.all(\n\t\t\tfiles.map(async (file, i) => {\n\t\t\t\tif (file.size > maxAssetSize) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`File size too big: ${(file.size / 1024).toFixed()}kb > ${(\n\t\t\t\t\t\t\tmaxAssetSize / 1024\n\t\t\t\t\t\t).toFixed()}kb`\n\t\t\t\t\t)\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\t// Use mime type instead of file ext, this is because\n\t\t\t\t// window.navigator.clipboard does not preserve file names\n\t\t\t\t// of copied files.\n\t\t\t\tif (!file.type) {\n\t\t\t\t\tthrow new Error('No mime type')\n\t\t\t\t}\n\n\t\t\t\t// We can only accept certain extensions (either images or a videos)\n\t\t\t\tif (!acceptedImageMimeTypes.concat(acceptedVideoMimeTypes).includes(file.type)) {\n\t\t\t\t\tconsole.warn(`${file.name} not loaded - Extension not allowed.`)\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst asset = await editor.getAssetForExternalContent({ type: 'file', file })\n\n\t\t\t\t\tif (!asset) {\n\t\t\t\t\t\tthrow Error('Could not create an asset')\n\t\t\t\t\t}\n\n\t\t\t\t\tassets[i] = asset\n\t\t\t\t} catch (error) {\n\t\t\t\t\ttoasts.addToast({\n\t\t\t\t\t\ttitle: msg('assets.files.upload-failed'),\n\t\t\t\t\t\tseverity: 'error',\n\t\t\t\t\t})\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t\treturn null\n\t\t\t\t}\n\t\t\t})\n\t\t)\n\n\t\tcreateShapesForAssets(editor, compact(assets), pagePoint)\n\t})\n\n\t// text\n\teditor.registerExternalContentHandler('text', async ({ point, text }) => {\n\t\tconst p =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey\n\t\t\t\t? editor.inputs.currentPagePoint\n\t\t\t\t: editor.getViewportPageBounds().center)\n\n\t\tconst defaultProps = editor.getShapeUtil<TLTextShape>('text').getDefaultProps()\n\n\t\tconst textToPaste = cleanupText(text)\n\n\t\t// If we're pasting into a text shape, update the text.\n\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\tif (onlySelectedShape && 'text' in onlySelectedShape.props) {\n\t\t\teditor.updateShapes([\n\t\t\t\t{\n\t\t\t\t\tid: onlySelectedShape.id,\n\t\t\t\t\ttype: onlySelectedShape.type,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttext: textToPaste,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\n\t\t\treturn\n\t\t}\n\n\t\t// Measure the text with default values\n\t\tlet w: number\n\t\tlet h: number\n\t\tlet autoSize: boolean\n\t\tlet align = 'middle' as TLTextShapeProps['textAlign']\n\n\t\tconst isMultiLine = textToPaste.split('\\n').length > 1\n\n\t\t// check whether the text contains the most common characters in RTL languages\n\t\tconst isRtl = isRightToLeftLanguage(textToPaste)\n\n\t\tif (isMultiLine) {\n\t\t\talign = isMultiLine ? (isRtl ? 'end' : 'start') : 'middle'\n\t\t}\n\n\t\tconst rawSize = editor.textMeasure.measureText(textToPaste, {\n\t\t\t...TEXT_PROPS,\n\t\t\tfontFamily: FONT_FAMILIES[defaultProps.font],\n\t\t\tfontSize: FONT_SIZES[defaultProps.size],\n\t\t\tmaxWidth: null,\n\t\t})\n\n\t\tconst minWidth = Math.min(\n\t\t\tisMultiLine ? editor.getViewportPageBounds().width * 0.9 : 920,\n\t\t\tMath.max(200, editor.getViewportPageBounds().width * 0.9)\n\t\t)\n\n\t\tif (rawSize.w > minWidth) {\n\t\t\tconst shrunkSize = editor.textMeasure.measureText(textToPaste, {\n\t\t\t\t...TEXT_PROPS,\n\t\t\t\tfontFamily: FONT_FAMILIES[defaultProps.font],\n\t\t\t\tfontSize: FONT_SIZES[defaultProps.size],\n\t\t\t\tmaxWidth: minWidth,\n\t\t\t})\n\t\t\tw = shrunkSize.w\n\t\t\th = shrunkSize.h\n\t\t\tautoSize = false\n\t\t\talign = isRtl ? 'end' : 'start'\n\t\t} else {\n\t\t\t// autosize is fine\n\t\t\tw = rawSize.w\n\t\t\th = rawSize.h\n\t\t\tautoSize = true\n\t\t}\n\n\t\tif (p.y - h / 2 < editor.getViewportPageBounds().minY + 40) {\n\t\t\tp.y = editor.getViewportPageBounds().minY + 40 + h / 2\n\t\t}\n\n\t\teditor.createShapes<TLTextShape>([\n\t\t\t{\n\t\t\t\tid: createShapeId(),\n\t\t\t\ttype: 'text',\n\t\t\t\tx: p.x - w / 2,\n\t\t\t\ty: p.y - h / 2,\n\t\t\t\tprops: {\n\t\t\t\t\ttext: textToPaste,\n\t\t\t\t\t// if the text has more than one line, align it to the left\n\t\t\t\t\ttextAlign: align,\n\t\t\t\t\tautoSize,\n\t\t\t\t\tw,\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\t})\n\n\t// url\n\teditor.registerExternalContentHandler('url', async ({ point, url }) => {\n\t\t// try to paste as an embed first\n\t\tconst embedInfo = getEmbedInfo(url)\n\n\t\tif (embedInfo) {\n\t\t\treturn editor.putExternalContent({\n\t\t\t\ttype: 'embed',\n\t\t\t\turl: embedInfo.url,\n\t\t\t\tpoint,\n\t\t\t\tembed: embedInfo.definition,\n\t\t\t})\n\t\t}\n\n\t\tconst position =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey\n\t\t\t\t? editor.inputs.currentPagePoint\n\t\t\t\t: editor.getViewportPageBounds().center)\n\n\t\tconst assetId: TLAssetId = AssetRecordType.createId(getHashForString(url))\n\t\tconst shape = createEmptyBookmarkShape(editor, url, position)\n\n\t\t// Use an existing asset if we have one, or else else create a new one\n\t\tlet asset = editor.getAsset(assetId) as TLAsset\n\t\tlet shouldAlsoCreateAsset = false\n\t\tif (!asset) {\n\t\t\tshouldAlsoCreateAsset = true\n\t\t\ttry {\n\t\t\t\tconst bookmarkAsset = await editor.getAssetForExternalContent({ type: 'url', url })\n\t\t\t\tif (!bookmarkAsset) throw Error('Could not create an asset')\n\t\t\t\tasset = bookmarkAsset\n\t\t\t} catch (e) {\n\t\t\t\ttoasts.addToast({\n\t\t\t\t\ttitle: msg('assets.url.failed'),\n\t\t\t\t\tseverity: 'error',\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\teditor.batch(() => {\n\t\t\tif (shouldAlsoCreateAsset) {\n\t\t\t\teditor.createAssets([asset])\n\t\t\t}\n\n\t\t\teditor.updateShapes([\n\t\t\t\t{\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: shape.type,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tassetId: asset.id,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\t\t})\n\t})\n}\n\nexport async function createShapesForAssets(\n\teditor: Editor,\n\tassets: TLAsset[],\n\tposition: VecLike\n): Promise<TLShapeId[]> {\n\tif (!assets.length) return []\n\n\tconst currentPoint = Vec.From(position)\n\tconst partials: TLShapePartial[] = []\n\n\tfor (let i = 0; i < assets.length; i++) {\n\t\tconst asset = assets[i]\n\t\tswitch (asset.type) {\n\t\t\tcase 'bookmark': {\n\t\t\t\tpartials.push({\n\t\t\t\t\tid: createShapeId(),\n\t\t\t\t\ttype: 'bookmark',\n\t\t\t\t\tx: currentPoint.x,\n\t\t\t\t\ty: currentPoint.y,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tassetId: asset.id,\n\t\t\t\t\t\turl: asset.props.src,\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tcurrentPoint.x += 300 // BOOKMARK_WIDTH\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'image': {\n\t\t\t\tpartials.push({\n\t\t\t\t\tid: createShapeId(),\n\t\t\t\t\ttype: 'image',\n\t\t\t\t\tx: currentPoint.x,\n\t\t\t\t\ty: currentPoint.y,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tassetId: asset.id,\n\t\t\t\t\t\tw: asset.props.w,\n\t\t\t\t\t\th: asset.props.h,\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tcurrentPoint.x += asset.props.w\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'video': {\n\t\t\t\tpartials.push({\n\t\t\t\t\tid: createShapeId(),\n\t\t\t\t\ttype: 'video',\n\t\t\t\t\tx: currentPoint.x,\n\t\t\t\t\ty: currentPoint.y,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tassetId: asset.id,\n\t\t\t\t\t\tw: asset.props.w,\n\t\t\t\t\t\th: asset.props.h,\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tcurrentPoint.x += asset.props.w\n\t\t\t}\n\t\t}\n\t}\n\n\teditor.batch(() => {\n\t\t// Create any assets\n\t\tconst assetsToCreate = assets.filter((asset) => !editor.getAsset(asset.id))\n\t\tif (assetsToCreate.length) {\n\t\t\teditor.createAssets(assetsToCreate)\n\t\t}\n\n\t\t// Create the shapes\n\t\teditor.createShapes(partials).select(...partials.map((p) => p.id))\n\n\t\t// Re-position shapes so that the center of the group is at the provided point\n\t\tcenterSelectionAroundPoint(editor, position)\n\t})\n\n\treturn partials.map((p) => p.id)\n}\n\nfunction centerSelectionAroundPoint(editor: Editor, position: VecLike) {\n\t// Re-position shapes so that the center of the group is at the provided point\n\tconst viewportPageBounds = editor.getViewportPageBounds()\n\tlet selectionPageBounds = editor.getSelectionPageBounds()\n\n\tif (selectionPageBounds) {\n\t\tconst offset = selectionPageBounds!.center.sub(position)\n\n\t\teditor.updateShapes(\n\t\t\teditor.getSelectedShapes().map((shape) => {\n\t\t\t\tconst localRotation = editor.getShapeParentTransform(shape).decompose().rotation\n\t\t\t\tconst localDelta = Vec.Rot(offset, -localRotation)\n\t\t\t\treturn {\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: shape.type,\n\t\t\t\t\tx: shape.x! - localDelta.x,\n\t\t\t\t\ty: shape.y! - localDelta.y,\n\t\t\t\t}\n\t\t\t})\n\t\t)\n\t}\n\n\t// Zoom out to fit the shapes, if necessary\n\tselectionPageBounds = editor.getSelectionPageBounds()\n\tif (selectionPageBounds && !viewportPageBounds.contains(selectionPageBounds)) {\n\t\teditor.zoomToSelection()\n\t}\n}\n\nexport function createEmptyBookmarkShape(\n\teditor: Editor,\n\turl: string,\n\tposition: VecLike\n): TLBookmarkShape {\n\tconst partial: TLShapePartial = {\n\t\tid: createShapeId(),\n\t\ttype: 'bookmark',\n\t\tx: position.x - 150,\n\t\ty: position.y - 160,\n\t\topacity: 1,\n\t\tprops: {\n\t\t\tassetId: null,\n\t\t\turl,\n\t\t},\n\t}\n\n\teditor.batch(() => {\n\t\teditor.createShapes([partial]).select(partial.id)\n\t\tcenterSelectionAroundPoint(editor, position)\n\t})\n\n\treturn editor.getShape(partial.id) as TLBookmarkShape\n}\n\nconst objectURLCache = new WeakCache<TLAsset, ReturnType<typeof getLocalAssetObjectURL>>()\nexport const defaultResolveAsset =\n\t(persistenceKey?: string) => async (asset: TLAsset | null | undefined) => {\n\t\tif (!asset || !asset.props.src) return null\n\n\t\t// Retrieve a local image from the DB.\n\t\tif (persistenceKey && asset.props.src.startsWith('asset:')) {\n\t\t\treturn await objectURLCache.get(\n\t\t\t\tasset,\n\t\t\t\tasync () => await getLocalAssetObjectURL(persistenceKey, asset.id)\n\t\t\t)\n\t\t}\n\n\t\t// We don't deal with videos at the moment.\n\t\tif (asset.type === 'video') return asset.props.src\n\n\t\t// Assert it's an image to make TS happy.\n\t\tif (asset.type !== 'image') return null\n\n\t\treturn asset.props.src\n\t}\n\nasync function getLocalAssetObjectURL(persistenceKey: string, assetId: TLAssetId) {\n\tconst blob = await getAssetFromIndexedDb({\n\t\tassetId: assetId,\n\t\tpersistenceKey,\n\t})\n\tif (blob) {\n\t\treturn URL.createObjectURL(blob)\n\t}\n\treturn null\n}\n"],
  "mappings": "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",
  "names": []
}
