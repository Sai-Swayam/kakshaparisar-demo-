{
  "version": 3,
  "sources": ["../../../../src/lib/shapes/shared/useAsset.ts"],
  "sourcesContent": ["import { TLAssetId, TLShapeId, useEditor, useValue } from '@tldraw/editor'\nimport { useEffect, useState } from 'react'\n\n/** @internal */\nexport function useAsset(shapeId: TLShapeId, assetId: TLAssetId | null, width: number) {\n\tconst editor = useEditor()\n\tconst [url, setUrl] = useState<string | null>(null)\n\tconst asset = assetId ? editor.getAsset(assetId) : null\n\tconst culledShapes = editor.getCulledShapes()\n\tconst isCulled = culledShapes.has(shapeId)\n\n\tconst shapeScale = asset && 'w' in asset.props ? width / asset.props.w : 1\n\t// We debounce the zoom level to reduce the number of times we fetch a new image and,\n\t// more importantly, to not cause zooming in and out to feel janky.\n\tconst screenScale = useValue('zoom level', () => editor.getZoomLevel() * shapeScale, [\n\t\teditor,\n\t\tshapeScale,\n\t])\n\n\tuseEffect(() => {\n\t\tif (isCulled) return\n\n\t\tlet isCancelled = false\n\t\tconst timer = editor.timers.setTimeout(async () => {\n\t\t\tconst resolvedUrl = await editor.resolveAssetUrl(assetId, {\n\t\t\t\tscreenScale,\n\t\t\t})\n\t\t\tif (!isCancelled) setUrl(resolvedUrl)\n\t\t}, 500)\n\n\t\treturn () => {\n\t\t\tclearTimeout(timer)\n\t\t\tisCancelled = true\n\t\t}\n\t}, [assetId, asset?.props.src, isCulled, screenScale, editor])\n\n\treturn { asset, url }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAA0D;AAC1D,mBAAoC;AAG7B,SAAS,SAAS,SAAoB,SAA2B,OAAe;AACtF,QAAM,aAAS,yBAAU;AACzB,QAAM,CAAC,KAAK,MAAM,QAAI,uBAAwB,IAAI;AAClD,QAAM,QAAQ,UAAU,OAAO,SAAS,OAAO,IAAI;AACnD,QAAM,eAAe,OAAO,gBAAgB;AAC5C,QAAM,WAAW,aAAa,IAAI,OAAO;AAEzC,QAAM,aAAa,SAAS,OAAO,MAAM,QAAQ,QAAQ,MAAM,MAAM,IAAI;AAGzE,QAAM,kBAAc,wBAAS,cAAc,MAAM,OAAO,aAAa,IAAI,YAAY;AAAA,IACpF;AAAA,IACA;AAAA,EACD,CAAC;AAED,8BAAU,MAAM;AACf,QAAI;AAAU;AAEd,QAAI,cAAc;AAClB,UAAM,QAAQ,OAAO,OAAO,WAAW,YAAY;AAClD,YAAM,cAAc,MAAM,OAAO,gBAAgB,SAAS;AAAA,QACzD;AAAA,MACD,CAAC;AACD,UAAI,CAAC;AAAa,eAAO,WAAW;AAAA,IACrC,GAAG,GAAG;AAEN,WAAO,MAAM;AACZ,mBAAa,KAAK;AAClB,oBAAc;AAAA,IACf;AAAA,EACD,GAAG,CAAC,SAAS,OAAO,MAAM,KAAK,UAAU,aAAa,MAAM,CAAC;AAE7D,SAAO,EAAE,OAAO,IAAI;AACrB;",
  "names": []
}
